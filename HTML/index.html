<!DOCTYPE html> 
<html lang="pt-br"> <!-- Define o idioma da página como português do Brasil -->
<head> <!-- Cabeçalho da página -->
  <meta charset="UTF-8"> <!-- Define a codificação de caracteres como UTF-8 -->
  <title>SOLICITAÇÃO DE VOO</title> <!-- Título da página -->
  <style> /* Estilos CSS para a página */

    
body { /* Estilo para o corpo da página */
  margin: 0; /* Remove margens padrão do body */
  font-family: Arial, sans-serif; /* Fonte padrão */
  background-image: url('C:/Users/user/Documents/Minhas Programações/Mil_Aviação/IMAGENS/cessna-citation-gen3-novo_widelg.jpg'); /* Define a imagem de fundo */
  background-size: cover; /* Faz a imagem cobrir toda a tela */
  background-position: center; /* Centraliza a imagem */
  background-repeat: no-repeat; /* Impede a repetição da imagem */
}

header { /* Estilo para o cabeçalho */
  display: flex; /* Usa Flexbox para organizar os elementos */
  justify-content: center; /* Centraliza a imagem horizontalmente */
  align-items: center; /* Centraliza a imagem verticalmente */
  padding: 20px; /* Adiciona espaçamento interno */
  background-color: #283128; /* Fundo LightGreen */
  box-shadow: 0 0px 0px rgba(0, 0, 0, 0.1); /* Adiciona uma leve sombra */
}

header img { /* Estilo para a imagem do cabeçalho */
  height: 130px; /* Define a altura da imagem */
}


    .titulo-central { /* Estilo para o título centralizado */

      background-color: #0d1f1e; /* Cor de fundo do título */
      color: white; /* Cor do texto */
      text-align: center; /* Centraliza o texto */
      padding: 10px 0; /* Espaçamento interno */
      font-size: 32px; /* Tamanho da fonte */
      font-weight: bold;   
      letter-spacing: 10px; /* Espaçamento entre letras */
    }


    .button-container { /* Estilo para o contêiner dos botões */
  display: flex; /* Usa Flexbox para organizar os botões */
  flex-direction: row; /* Organiza os botões na vertical */
  gap: 290px; /* Espaço entre os botões */
  align-items: flex-start; /* Alinha os botões no centro */
  margin-top: 350px; /* Espaço acima dos botões */
  padding-left: 30px; /* Adiciona um pequeno espaçamento da borda esquerda */
}


    button { /* Estilo para os botões */
      font-size: 20px; /* Tamanho da fonte */
      padding: 15px 30px; /* Espaçamento interno do botão */
      border: none; /* Remove a borda padrão */
      border: 2px solid black; /* Borda preta de 2px */
      border-radius: 8px; /* Bordas arredondadas */
      color: white; /* Cor do texto */
      cursor: pointer;  /* Cursor de ponteiro ao passar o mouse */
    }

    button:hover { /* Efeito ao passar o mouse sobre os botões */
      opacity: 0.8; /* Reduz a opacidade */
    }
    button:active { /* Efeito ao clicar nos botões */
      transform: scale(0.95); /* Reduz o tamanho do botão */
    }
    .mib {background: linear-gradient(to bottom, #125296, #b3bed3);} 
    .krt {background: linear-gradient(to bottom, #FF4500, #e9c5a4);} 
    .mep {background: linear-gradient(to bottom, #110342, #f1f3f2);}
    .rbz {background: linear-gradient(to bottom, #333231, #969797);}

    .form-button-fixed { /* Classe para manter o botão fixo */
      position: absolute; /* Posiciona o botão de forma absoluta */
      left: 600px; /* Alinha o botão à esquerda */
      top: 250px; /* Alinha o botão ao topo */
    }

    form { /* Estilo para o formulário */
      display: none; /* Oculta o formulário inicialmente */
      max-width: 600px; /* Largura máxima do formulário */
      margin: -250px auto; /* Centraliza o formulário verticalmente */
      padding: 40px; /* Espaçamento interno do formulário */
      background-color: #f5c89e; /* Cor de fundo do formulário */
      border-radius: 10px; /* Bordas arredondadas */
      box-shadow: 0 0 10px rgba(0,0,0,0.1); /* Sombra do formulário */
    }

    form label { /* Estilo para os rótulos do formulário */
      display: grid; /* Usa grid para organizar os rótulos */
      margin-top: 20px; /* Espaçamento acima dos rótulos */
      font-weight: bold; /* Negrito para os rótulos */
    }

    form input { /* Estilo para os campos de entrada do formulário */
      width: 100%; /* Largura total do campo */
      padding: 10px; /* Espaçamento interno do campo */
      margin-top: 5px; /* Espaçamento acima do campo */
      border: 1px solid #152c0b; /* Borda do campo */
      border-radius: 5px; /* Bordas arredondadas */
    }

    .submit-btn { /* Estilo para o botão de envio */
      background-color: #1c924d; /* Cor de fundo do botão */
      color: white; /* Cor do texto */
      margin-top: 20px; /* Espaçamento acima do botão */
      cursor: pointer; /* Cursor de ponteiro ao passar o mouse */
    }

    #voosAgendados { /* Estilo para a lista de voos agendados */
      display: none; /* Oculta a lista inicialmente */
      padding: 5px; /* Espaçamento interno da lista */
      margin: 10px auto; /* Centraliza a lista */
      max-width: 1500px; /* Largura máxima da lista */
      background: #eee; /* Cor de fundo da lista */
      border-radius: 10px; /* Bordas arredondadas */
    }

    .voo-item { /* Estilo para cada item da lista de voos */
      display: flex; /* Usa flexbox para organizar os itens */
      gap: 30px; /* Espaço entre os itens */
      background: white; /* Cor de fundo dos itens */
      padding: 15px; /* Espaçamento interno dos itens */
      margin-top: 10px; /* Espaçamento acima dos itens */
      border-radius: 8px; /* Bordas arredondadas dos itens */
      font-size: 14px; /* Tamanho da fonte dos itens */
      flex-wrap: wrap; /* Permite que os itens se movam para a próxima linha se não houver espaço suficiente */
    }

    .voo-item div { /* Estilo para os divs dentro dos itens da lista */
      min-width: 100px; /* Largura mínima dos divs */
    }

    .pax-list { /* Estilo para a lista de passageiros */
      display: none; /* Oculta a lista inicialmente */
      flex-direction: column; /* Organiza os passageiros em coluna */
      margin-top: 10px; /* Espaçamento acima da lista de passageiros */
      padding-left: 10px; /* Espaçamento à esquerda da lista de passageiros */
      font-size: 13px; /* Tamanho da fonte da lista de passageiros */
    }
 
    .controls { /* Estilo para os controles */
      display: flex; /* Usa flexbox para organizar os controles */
      justify-content: center; /* Centraliza os controles */
      gap: 15px; /* Espaço entre os controles */
      margin: 20px auto; /* Centraliza os controles */
    }
 
    #verVoos { /* Estilo para o botão "VOOS AGENDADOS" */
      display: none; /* Oculta o botão inicialmente */
      background: #333; /* Cor de fundo do botão */
      color: white; /* Cor do texto */
      padding: 12px 20px; /* Espaçamento interno do botão */
      border: none; /* Remove a borda padrão */
      border-radius: 100px; /* Bordas arredondadas */
      cursor: pointer; /* Cursor de ponteiro ao passar o mouse */
    }

    .btn-pax { /* Estilo para o botão "Ver Pax" */
      background: #006400; /* Cor de fundo do botão */
      color: white; /* Cor do texto */
      border: none; /* Remove a borda padrão */
      padding: 4px 8px; /* Espaçamento interno do botão */
      font-size: 12px; /* Tamanho da fonte do botão */
      margin-top: 5px; /* Espaçamento acima do botão */
      border-radius: 5px; /* Bordas arredondadas */
      cursor: pointer; /* Cursor de ponteiro ao passar o mouse */
    }

      .btn-cancelar { /* Estilo para o botão "Cancelar Voo" */
     background: #e74c3c; /* Vermelho */
     color: white; /* Cor do texto */
     border: none; /* Remove a borda padrão */
     padding: 4px 8px;  /* Espaçamento interno do botão */
     font-size: 12px; /* Tamanho da fonte do botão */
     margin-top: 5px; /* Espaçamento acima do botão */
     border-radius: 5px;  /* Bordas arredondadas */
     cursor: pointer; /* Cursor de ponteiro ao passar o mouse */
}

      .controls button {  /* Estilo para os botões de controle */
     background: #2980b9; /* Cor de fundo do botão */
     background: #2c3e50; /* Cor de fundo do botão */
     color: white; /* Cor do texto */
     padding: 12px 20px; /* Espaçamento interno do botão */
     border: none;    /* Remove a borda padrão */
     border-radius: 100px;  /* Bordas arredondadas */
     cursor: pointer; /* Cursor de ponteiro ao passar o mouse */
}

.etapa-label { /* Estilo para o rótulo da etapa */
  display: block;        /* Faz a label se comportar como um bloco */
  width: 100%;           /* Ocupa 100% da largura do contêiner pai */
  text-align: center;    /* Centraliza o texto */
  font-weight: bold;     /* Opcional: destaque no texto */
  margin: 30px 0;        /* Espaçamento vertical */
  text-decoration: underline; /* Sublinha o texto */
  font-size: 18px; /* Tamanho da fonte */
  color: #000; /* ou qualquer outra cor */
  background-color: #faa454; /* Cor de fundo para destacar */
  padding: 10px; /* Espaçamento interno para melhorar a legibilidade */
  border: 1px solid #152c0b; /* Borda para destacar */
}


  </style>  
</head> 
<body>

  <header> <!-- Cabeçalho da página -->
    <img src="C:/Users/user/Documents/Programação/Mil_Aviacao/LOGO/LOGO MIL AVIAÇÃO -.png" alt="Logo MIL AVIAÇÃO"> <!-- Logo da empresa -->
  </header> <!-- Fim do cabeçalho -->
  </header> <!-- Fim do cabeçalho -->

  <div class="titulo-central">SOLICITAÇÃO DE VOO</div> <!-- Título centralizado -->

  <div id="buttonContainer" class="button-container"> <!-- Contêiner para os botões -->
    <button class="mib" onclick="mostrarFormulario(6, 'MIB')">MIB</button> <!-- Botão para MIB -->
    <button class="krt" onclick="mostrarFormulario(8, 'KRT')">KRT</button> <!-- Botão para KRT -->
    <button class="mep" onclick="mostrarFormulario(9, 'MEP')">MEP</button> <!-- Botão para MEP -->
    <button class="rbz" onclick="mostrarFormulario(13, 'RBZ')">RBZ</button> <!-- Botão para RBZ -->
  </div>

  

  <form id="formulario" method="POST"> <!-- Formulário para solicitação de voo -->

    <label class="etapa-label">1ª ETAPA</label> <!-- Rótulo para a primeira etapa -->

    <label>1 - Empresa:</label> <!-- Rótulo para o campo "Empresa" -->
    <input type="text" name="empresa" required> <!-- Campo de entrada para o nome da empresa -->

    <label>2 - Data:</label> <!-- Rótulo para o campo "Data" -->
    <input type="date" name="data" required> <!-- Campo de entrada para a data do voo -->

    <label>3 - Origem:</label> <!-- Rótulo para o campo "Origem" -->
    <input type="text" name="origem" required> <!-- Campo de entrada para a origem do voo -->

    <label>4 - Destino:</label> <!-- Rótulo para o campo "Destino" -->
    <input type="text" name="destino" required> <!-- Campo de entrada para o destino do voo -->

    <label>5 - Hora:</label> <!-- Rótulo para o campo "Hora" -->
    <input type="time" name="hora" required> <!-- Campo de entrada para a hora do voo -->

    <label>6 - Lista de Pax:</label> <!-- Rótulo para a lista de passageiros -->
    <div id="pax-container"></div> <!-- Contêiner para os campos de entrada dos passageiros -->

    <label>7 - Email do solicitante:</label> <!-- Rótulo para o campo "Email" -->
    <input type="email" name="email" required> <!-- Campo de entrada para o email do solicitante -->

    <label>8 - Data que solicitou:</label> <!-- Rótulo para o campo "Data que solicitou" -->
    <input type="text" name="dataSolicitada" id="dataSolicitada" readonly> <!-- Campo de entrada para a data que solicitou, somente leitura -->
  
    
        <button type="submit" class="submit-btn">Enviar</button> <!-- Botão de envio do formulário -->
        <button type="button" onclick="cancelarFormulario()" 
        style=
        "margin-left: 10px; 
        background-color: #cc2c17; 
        color: white; 
        padding: 10px 20px; 
        border: none; 
        border-radius: 8px; 
        cursor: pointer;
        ">Cancelar</button>

  </form> <!-- Botão de cancelar o formulário -->

  <div class="controls"> <!-- Contêiner para os controles -->
    <button id="verVoos" onclick="mostrarVoos()">VOOS AGENDADOS</button> <!-- Botão para visualizar os voos agendados -->   
    <button onclick="exportarCSV()">EXPORTAR CSV</button> <!-- Botão para exportar os voos agendados para CSV -->
  </div>
  


  <div id="voosAgendados"></div> <!-- Contêiner para exibir os voos agendados -->

  <script> // Script para gerenciar a exibição do formulário e os voos agendados
    let voos = JSON.parse(localStorage.getItem("voos")) || []; // Obtém os voos armazenados no localStorage ou inicializa como um array vazio
    let ordemBase = 20250000; // Base para gerar a ordem de serviço
    let editandoIndex = null; // Variável para armazenar o índice do voo que está sendo editado

    function mostrarFormulario(qtdPax, tipo) { // Função para exibir o formulário de solicitação de voo
      const botoes = document.querySelectorAll(".button-container button"); // Seleciona todos os botões da classe button-container
      botoes.forEach(btn => { // Itera sobre os botões
        if (btn.innerText !== tipo) btn.style.display = "none"; // Oculta os botões que não foram clicados
        else btn.style.display = "inline-block"; // Mantém o botão clicado visível
        if (btn.innerText !== tipo) btn.classList.remove("form-button-fixed"); // Remove a classe de botão fixo dos outros botões
        else btn.classList.add("form-button-fixed"); // Adiciona a classe de botão fixo ao botão clicado
      });

      function cancelarVoo(index) {  // Função para cancelar um voo agendado
  if (confirm("Tem certeza que deseja cancelar esta solicitação?")) {  // Confirmação antes de cancelar
    voos.splice(index, 1); // Remove o voo da lista pelo índice
    localStorage.setItem("voos", JSON.stringify(voos)); // Atualiza os dados armazenados
    mostrarVoos(); // Atualiza a exibição da lista de voos
  }
}


      const agora = new Date(); // Obtém a data e hora atual
      const dataHoraFormatada = agora.toLocaleDateString('pt-BR') + ' ' + agora.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }); // Formata a data e hora atual
      document.getElementById("dataSolicitada").value = dataHoraFormatada; // Formata a data e hora atual para o campo "Data que solicitou"

      const paxContainer = document.getElementById("pax-container"); // Seleciona o contêiner onde os campos de passageiros serão adicionados
      paxContainer.innerHTML = ""; // Limpa o contêiner antes de adicionar novos campos
      for (let i = 1; i <= qtdPax; i++) { // Adiciona os campos de entrada para os passageiros
        paxContainer.innerHTML += `<input type="text" name="pax${i}" placeholder="Passageiro ${i}">`;  // Campo de entrada para o passageiro
      } 

      document.getElementById("formulario").style.display = "block"; // Exibe o formulário
    }



     
    function cancelarFormulario() {  // Função para cancelar o formulário
      document.getElementById("formulario").style.display = "none"; // Oculta o formulário
      document.querySelectorAll(".button-container button").forEach(btn => { // Seleciona todos os botões da classe button-container
        btn.style.display = "inline-block"; // Exibe todos os botões novamente
        btn.classList.remove("form-button-fixed"); // Remove a classe de botão fixo de todos os botões
      }); 
      document.getElementById("formulario").reset(); // Reseta o formulário
    }



    document.getElementById("formulario").addEventListener("submit", function(event) {  // Adiciona um evento de envio ao formulário
      event.preventDefault(); // Previne o envio padrão do formulário
      const form = event.target; // Obtém o formulário que disparou o evento
      const dados = new FormData(form); // Cria um objeto FormData com os dados do formulário

      let voo = { 
        os: (ordemBase + voos.length), // Gera um número de ordem de serviço único
        aeronave: document.querySelector(".form-button-fixed")?.innerText || "Desconhecida", // Obtém o nome do botão clicado
        empresa: dados.get("empresa"), // Obtém o valor do campo "empresa"
        data: dados.get("data"), // Obtém o valor do campo "data"
        origem: dados.get("origem"), // Obtém o valor do campo "origem"
        destino: dados.get("destino"), // Obtém o valor do campo "destino"
        hora: dados.get("hora"), // Obtém o valor do campo "hora"
        pax: [], // Inicializa um array vazio para os passageiros
        email: dados.get("email"), // Obtém o valor do campo "email"
        dataSolicitada: dados.get("dataSolicitada") // Obtém o valor do campo "dataSolicitada"
      };

      for (let [key, value] of dados.entries()) {  // Itera sobre os dados do formulário
        if (key.startsWith("pax") && value.trim() !== "") { // Verifica se o campo é um passageiro e não está vazio
          voo.pax.push(value); // Adiciona o passageiro ao array de passageiros
        }
      }

      if (editandoIndex !== null) { // Verifica se está editando um voo existente
        voos[editandoIndex] = voo; // Atualiza o voo existente com os novos dados
        editandoIndex = null; // Reseta o índice de edição
      } else { // Se não estiver editando, adiciona um novo voo
        voos.push(voo); // Adiciona o novo voo à lista de voos
      }

      localStorage.setItem("voos", JSON.stringify(voos)); // Armazena os voos no localStorage
      document.getElementById("verVoos").style.display = "block"; // Exibe o botão "VOOS AGENDADOS" após o envio do formulário

      fetch("https://formsubmit.co/ajax/wellington@rbftaxiaereo.com.br", { // URL do FormSubmit
        method: "POST",
        headers: { "Content-Type": "application/json" }, // Define o tipo de conteúdo como JSON
        body: JSON.stringify({  
          OS: voo.os, // Corrigido para usar voo.os
          Aeronave: voo.aeronave, // Corrigido para usar voo.aeronave
          Empresa: voo.empresa, // Corrigido para usar voo.empresa
          Data: voo.data, // Corrigido para usar voo.data
          Origem: voo.origem, // Corrigido para usar voo.origem
          Destino: voo.destino, // Corrigido para usar voo.destino
          Hora: voo.hora, // Corrigido para usar voo.hora
          Pax: voo.pax.join(", "),  // Converte o array de passageiros em uma string
          Email: voo.email, // Corrigido para usar voo.email
          Solicitado_em: voo.dataSolicitada  // Corrigido para usar voo.dataSolicitada
        })
      })
      .then(response => { // Faz a requisição para o FormSubmit
        if (!response.ok) throw new Error("Erro ao enviar."); // Lança um erro se a resposta não for ok
        alert("Voo agendado com sucesso!"); // Exibe um alerta de sucesso
        form.reset(); // Reseta o formulário após o envio
        cancelarFormulario(); // Oculta o formulário após o envio
        mostrarVoos(); // Atualiza a exibição da lista de voos
      })
      .catch(error => { // Captura erros na requisição
        alert("Erro ao enviar o formulário. Tente novamente."); // Exibe um alerta em caso de erro
        console.error(error); // Exibe o erro no console para depuração
      });
    });

    function mostrarVoos() { // Função para exibir os voos agendados
      const container = document.getElementById("voosAgendados"); // Seleciona o contêiner onde os voos agendados serão exibidos
      container.innerHTML = ""; // Limpa o contêiner antes de adicionar novos voos
      if (voos.length === 0) {
        container.innerHTML = "<p>Nenhum voo agendado.</p>"; // Exibe mensagem se não houver voos agendados
        return; // Retorna se não houver voos agendados
      }
      voos.forEach((voo, i) => { // Itera sobre cada voo agendado
        const paxId = "paxList" + i; // Gera um ID único para a lista de passageiros
        container.innerHTML += `   
          <div class="voo-item"> 
            <div><strong>Ordem Serviço</strong><br>${voo.os}</div>
            <div><strong>Aeronave</strong><br>${voo.aeronave}</div>
            <div><strong>Empresa</strong><br>${voo.empresa}</div>
            <div><strong>Data</strong><br>${voo.data}</div>
            <div><strong>Origem</strong><br>${voo.origem}</div>
            <div><strong>Destino</strong><br>${voo.destino}</div>
            <div><strong>Hora</strong><br>${voo.hora}</div>
            <div><strong>Email</strong><br>${voo.email}</div>
            <div><strong>Solicitado em</strong><br>${voo.dataSolicitada}</div>
            <div>
              <button class="btn-pax" onclick="togglePax('${paxId}')">Ver Pax</button>
              <div id="${paxId}" class="pax-list">${voo.pax.map(p => `<div>${p}</div>`).join("")}</div> 
            </div>
             <button class="btn-cancelar" onclick="cancelarVoo(${i})">Cancelar Voo</button> 
             <div><strong>wellintonmota</strong><br>${voo.lo}</div> 
      </div> 
          </div>  
        `;
      });
      container.style.display = "block"; // Exibe a lista de voos agendados
      document.getElementById("verVoos").style.display = "none"; // Oculta o botão "VOOS AGENDADOS" após exibir a lista
    }


    
    function togglePax(id) { // Função para alternar a exibição da lista de passageiros
      const container = document.getElementById("voosAgendados"); // Seleciona o contêiner de voos agendados
      const el = document.getElementById(id); // Seleciona o elemento da lista de passageiros
      el.style.display = el.style.display === "flex" ? "none" : "flex"; // Alterna a exibição da lista de passageiros
    }

    

    function exportarCSV() { // Função para exportar os dados dos voos agendados para um arquivo CSV
      if (voos.length === 0) { // Verifica se há voos agendados
        alert("Nenhum voo agendado para exportar."); // Exibe um alerta se não houver voos agendados
        return; // Exibe um alerta se não houver voos agendados
      }

      

      let csvContent = "data:text/csv;charset=utf-8,"; // Inicia o conteúdo CSV
      csvContent += "Aeronave,Empresa,Data,Origem,Destino,Hora,Email,DataSolicitada,Passageiros\n"; // Cabeçalho do CSV

      voos.forEach(voo => { // Itera sobre cada voo agendado
        const linha = [ // Cria uma linha CSV com os dados do voo
          voo.aeronave, // Corrigido para usar voo.aeronave
          voo.empresa, // Corrigido para usar voo.empresa
          voo.os, // Corrigido para usar voo.os
          voo.data, // Corrigido para usar voo.data
          voo.origem, // Corrigido para usar voo.origem
          voo.destino, // Corrigido para usar voo.destino
          voo.hora, // Corrigido para usar voo.hora
          voo.email, // Corrigido para usar voo.email
          voo.dataSolicitada, // Corrigido para usar voo.dataSolicitada
          '"' + voo.pax.join(", ") + '"' // Corrigido para usar voo.pax.join(", ")
        ].join(","); // Junta os dados com vírgulas
        csvContent += linha + "\n"; // Adiciona a linha ao conteúdo CSV
  });

  const encodedUri = encodeURI(csvContent); // Codifica o conteúdo CSV
  const link = document.createElement("a"); // Cria um link temporário
  link.setAttribute("href", encodedUri); // Define o href do link como o conteúdo CSV codificado
  link.setAttribute("download", "voos_agendados.csv"); // Define o nome do arquivo para download
  document.body.appendChild(link); // Adiciona o link ao corpo do documento
  link.click(); // Simula um clique no link para iniciar o download
  document.body.removeChild(link); // Remove o link do documento após o download
}


    if (voos.length > 0) { // Verifica se há voos agendados
      document.getElementById("verVoos").style.display = "block"; // Exibe o botão de "VOOS AGENDADOS" se houver voos agendados
    }



    
  </script>

</body>
</html>
